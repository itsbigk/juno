function adminArchiveList(e,t,a,r,n){e.type="archived",e.flash=r;var o=function(){t.all().success(function(t){e.restaurants=t})};e.go=function(e){console.log(e);var t="/admin/restaurants/"+e._id;a.path(t)},e.restoreListing=function(e){t.archive(e,{archived:!1,archiveDate:""}).success(function(e){r.setMessage(e.message),n.go("admin-archive-list",{},{reload:!0}),o()}).error(function(e){r.setMessage(e.message),n.go("admin-archive-list",{},{reload:!0})})},o()}function createRestaurantController(e,t,a,r,n){function o(){$(".form-control").removeClass("error"),$(".error-message").remove()}function s(e){for(var t in e.errors){var a=e.errors[t].message.replace(/Path|`/g,"").trim(),r="#"+t;$(r).hasClass("error")||(console.log("has error: "+r),$(r+"-container").append("<div class='error-message'>"+a+"</div>")),$(r).addClass("error")}}e.$on("$viewContentLoaded",formImageInput),e.flash=r,e.type="create",e.formData={},e.saveRestaurant=function(){e.processing=!0,a.create(e.formData).success(function(t){e.processing=!1,void 0===t.errors?(r.setMessage(t.message),e.formData={},o(),n.path("/admin/restaurants/edit/menu/"+t.restaurant_id)):(o(),s(t))}).error(function(e){e.errors?s(e):(r.setMessage(e.message),t.go("admin-restaurant-new",{},{reload:!0}))})}}function deleteRestaurantController(e,t,a,r){e.type="delete";var n=function(){t.all().success(function(t){e.restaurants=t})};e.go=function(e){var t="/admin/restaurants/"+e._id;r.path(t)},e.deleteRestaurant=function(a){t["delete"](a).success(function(t){e.message=t.message,n()}).error(function(t){e.message=t.message})},n()}function editRestaurantController(e,t,a,r,n,o){function s(){$(".form-control").removeClass("error"),$(".error-message").remove()}function i(e){for(var t in e.errors){var a=e.errors[t].message.replace(/Path|`/g,"").trim(),r="#"+t;$(r).hasClass("error")||(console.log("has error: "+r),$(r+"-container").append("<div class='error-message'>"+a+"</div>")),$(r).addClass("error")}}function l(t){e.menuIndex=angular.element(t).scope().$index}function u(){var t;"create"===e.type||"edit"===e.type?t=e.formData.name:"menuEdit"===e.type&&(t=e.formData.menuItems[e.menuIndex].name),t&&(t=t.replace(/[^\w\s]|_/g," ").replace(/\s+/g,"_"));var a=Date.now().toString();return[a,t].join("_")}e.$on("$viewContentLoaded",formImageInput),e.flash=n,e.type="/admin/restaurants/edit/:restaurant_id"===o.current.url?"edit":"menuEdit",t.get(a.restaurant_id).success(function(t){e.formData=t}),e.addMenuItem=function(){var t={name:"",price:"",description:"",imageUrl:""};e.formData.menuItems.push(t)},e.removeItem=function(t){e.formData.menuItems.splice(t,1)},e.s3Upload=function(t){l(t),console.log(t),console.log(e.menuIndex);new S3Upload({s3_object_name:u(),file_dom_selector:"image",s3_sign_put_url:"/sign_s3",onFinishS3Put:function(t){"edit"===e.type||"create"===e.type?e.formData.imageUrl=t:"menuEdit"===e.type&&(console.log(e.formData.menuItems[e.menuIndex].imageUrl),e.formData.menuItems[e.menuIndex].imageUrl=t)},onError:function(e){n.setMessage(e)}})},e.saveRestaurant=function(){e.processing=!0,console.log(e.formData),t.update(a.restaurant_id,e.formData).success(function(t){e.processing=!1,void 0===t.errors?(n.setMessage(t.message),s(),o.go("admin-restaurant-index")):(s(),i(t))}).error(function(e){e.errors?i(e):(n.setMessage(e.message),o.go("admin-edit-restaurant",{},{reload:!0}))})}}function adminRestaurantIndex(e,t,a,r,n){e.type="list",e.flash=r;var o=function(){t.all().success(function(t){e.restaurants=t})};e.go=function(e){var t="/admin/restaurants/"+e._id;a.path(t)},e.archiveListing=function(e){t.archive(e,{archived:!0,archiveDate:Date.now()}).success(function(e){r.setMessage(e.message),n.go("admin-restaurant-index",{},{reload:!0}),o()}).error(function(e){r.setMessage(e.message),n.go("admin-restaurant-index",{},{reload:!0})})},o()}function viewRestaurantController(e,t,a,r){e.type="view",t.get(a.restaurant_id).success(function(t){e.restaurant=t})}function homeController(e,t){e.flash=t}function imageUpload(){return{restrict:"E",scope:{itemData:"="},templateUrl:"../../../partials/admin/restaurants/image-upload.html",link:function(e,t,a,r){function n(){var t;"create"===e.type||"edit"===e.type?t=e.formData.name:"menuEdit"===e.type&&(t=e.formData.menuItems[index].name),t&&(t=t.replace(/[^\w\s]|_/g," ").replace(/\s+/g,"_"));var a=Date.now().toString();return[a,t].join("_")}e.s3Upload=function(t){console.log(t);var a=angular.element(t).scope().$index;console.log(a);new S3Upload({s3_object_name:n(),file_dom_selector:"image",s3_sign_put_url:"/sign_s3",onFinishS3Put:function(t){e.formData.imageUrl=t},onError:function(e){flash.setMessage(e)}})}}}}angular.module("Juno",["ui.router"]),angular.module("Juno").controller("adminArchiveList",adminArchiveList),adminArchiveList.$inject=["$scope","Restaurant","$location","flash","$state"],angular.module("Juno").controller("createRestaurantController",createRestaurantController),createRestaurantController.$inject=["$scope","$state","Restaurant","flash","$location"],angular.module("Juno").controller("deleteRestaurantController",deleteRestaurantController),deleteRestaurantController.$inject=["$scope","Restaurant","$stateParams","$location"],angular.module("Juno").controller("editRestaurantController",editRestaurantController),editRestaurantController.$inject=["$scope","Restaurant","$stateParams","$location","flash","$state"],angular.module("Juno").controller("adminRestaurantIndex",adminRestaurantIndex),adminRestaurantIndex.$inject=["$scope","Restaurant","$location","flash","$state"],angular.module("Juno").controller("viewRestaurantController",viewRestaurantController),viewRestaurantController.$inject=["$scope","Restaurant","$stateParams","$location"],angular.module("Juno").controller("homeController",homeController),homeController.$inject=["$scope","flash"],angular.module("Juno").filter("capitalize",function(){return function(e,t){return e?e.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}):""}});var app=angular.module("Juno");app.directive("confirmClick",function(){return{priority:-1,restrict:"A",link:function(e,t,a){var r=a.confirmation||"Are you sure?";t.bind("click",function(t){if(window.confirm(r)){var n=a.confirmClick;n&&e.$apply(e.$eval(n))}})}}}),angular.module("Juno").directive("imageUpload",imageUpload),imageUpload.$inject=["$state"],angular.module("Juno").factory("flash",["$rootScope",function(e){var t=[],a="";return e.$on("$stateChangeSuccess",function(){a=t.shift()||""}),{setMessage:function(e){t.push(e)},getMessage:function(){return a}}}]),angular.module("Juno").factory("Restaurant",["$http",function(e){return{all:function(){return e.get("/api/restaurants")},get:function(t){return e.get("/api/restaurants/"+t)},create:function(t){return e.post("/api/restaurants",t)},update:function(t,a){return e.put("/api/restaurants/"+t,a)},archive:function(t,a){return e.patch("/api/restaurants/"+t,a)},"delete":function(t){return e["delete"]("/api/restaurants/"+t)}}}]),angular.module("Juno").config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,a){t.otherwise("/"),e.state("/",{url:"/",controller:"homeController",templateUrl:"partials/home.html"}).state("admin",{url:"/admin",controller:"adminRestaurantIndex",templateUrl:"partials/admin/admin.html"}).state("admin-restaurant-index",{url:"/admin/restaurants",controller:"adminRestaurantIndex",templateUrl:"partials/admin/restaurants/index.html"}).state("admin-archive-list",{url:"/admin/restaurants/archive",controller:"adminArchiveList",templateUrl:"partials/admin/restaurants/archives.html"}).state("admin-delete-restaurants",{url:"/admin/restaurants/delete",controller:"deleteRestaurantController",templateUrl:"partials/admin/restaurants/index.html"}).state("admin-restaurant-new",{url:"/admin/restaurants/new",controller:"createRestaurantController",templateUrl:"partials/admin/restaurants/restaurant.html"}).state("admin-edit-menu",{url:"/admin/restaurants/edit/menu/:restaurant_id",controller:"editRestaurantController",templateUrl:"partials/admin/restaurants/menu.html"}).state("admin-view-restaurant",{url:"/admin/restaurants/:restaurant_id",controller:"viewRestaurantController",templateUrl:"partials/admin/restaurants/viewRestaurant.html"}).state("admin-edit-restaurant",{url:"/admin/restaurants/edit/:restaurant_id",controller:"editRestaurantController",templateUrl:"partials/admin/restaurants/restaurant.html"})}]);